<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Recommendation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />

    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </head>
  <body>
    {% include 'navbar.html' %}

    <a href="javascript:history.back()" class="back-button">
      <svg width="13" height="22" viewBox="0 0 13 22" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 21L2 11L12 1" stroke="currentColor" stroke-width="2"/>
      </svg>
  </a>
    <div style="display: flex;flex-wrap: wrap;margin: 30px 200px 30px 200px; justify-content: space-between; align-items: center;">
      <h1 style="color: #fff;">Recommended Artworks</h1>

<div>
      <button style=" vertical-align: middle;background-color: transparent; height: 60px; border: 1px solid white; color: #fff;border-radius: 5px;padding-left: 20px; padding-right: 20px;" data-toggle="modal" data-target="#preference">
        See my preference
      </button>
  
      <button style=" vertical-align: middle; background-color: transparent; height: 60px;border: 1px solid white; color: #fff;border-radius: 5px;padding-left: 20px; padding-right: 20px;" data-toggle="modal" data-target="#weightModal">
        <span>
          <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.6655 25.1832C8.71066 24.6012 6.97064 23.5207 5.59284 22.089C6.10684 21.4799 6.41659 20.6928 6.41659 19.8334C6.41659 17.9004 4.84958 16.3334 2.91659 16.3334C2.79966 16.3334 2.68406 16.3391 2.57008 16.3503C2.4148 15.5911 2.33325 14.8051 2.33325 14C2.33325 12.7805 2.52037 11.6047 2.86746 10.4997C2.88381 10.4999 2.90018 10.5 2.91659 10.5C4.84958 10.5 6.41659 8.93301 6.41659 7.00002C6.41659 6.4451 6.28744 5.92039 6.0576 5.45419C7.40679 4.19967 9.05354 3.26081 10.8803 2.75513C11.4592 3.88974 12.6388 4.6667 13.9999 4.6667C15.361 4.6667 16.5407 3.88974 17.1195 2.75513C18.9463 3.26081 20.593 4.19967 21.9422 5.45419C21.7124 5.92039 21.5833 6.4451 21.5833 7.00002C21.5833 8.93301 23.1503 10.5 25.0833 10.5C25.0996 10.5 25.116 10.4999 25.1324 10.4997C25.4795 11.6047 25.6666 12.7805 25.6666 14C25.6666 14.8051 25.585 15.5911 25.4298 16.3503C25.3158 16.3391 25.2002 16.3334 25.0833 16.3334C23.1503 16.3334 21.5833 17.9004 21.5833 19.8334C21.5833 20.6928 21.893 21.4799 22.407 22.089C21.0292 23.5207 19.2892 24.6012 17.3344 25.1832C16.8832 23.772 15.5609 22.75 13.9999 22.75C12.4389 22.75 11.1166 23.772 10.6655 25.1832Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
            <path d="M14.0001 18.0833C16.2552 18.0833 18.0834 16.2551 18.0834 14C18.0834 11.7448 16.2552 9.91663 14.0001 9.91663C11.7449 9.91663 9.91675 11.7448 9.91675 14C9.91675 16.2551 11.7449 18.0833 14.0001 18.0833Z" stroke="white" stroke-width="2" stroke-linejoin="round"/>
            </svg>
            
        </span>
        Set up weight
      </button>
    </div>
    </div>





    <div
      style="
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin: 30px;
      "
    >
      <!-- Add cards here -->
      {% for artwork in recommended_artwork %}
      <a
        href="{{ url_for('recommended_detail', artwork_id=artwork.id) }}"
        style="text-decoration: none"
      >
        <div class="card" style="padding: 0">
          <img
            src="{{ artwork.image }}"
            alt="{{ artwork.title }}"
            class="card-img-top"
          />
          <div class="card-body" style="overflow: hidden">
            <h5 class="card-title" style="color: #fff; margin-top: 10px;">{{ artwork.title }}</h5>
            <!-- <p class="card-text" style="color: #fff">
              {{ artwork.artistName }} -->
              <div class="tags" id="tags-{{ artwork.id }}"></div>
            </p>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>

    <!-- model-->
    <div
    class="modal fade"
    id="weightModal"
    tabindex="-1"
    role="dialog"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <!-- 模态框头部 -->
        <div class="modal-header">
          <h5 class="modal-title" style="font-weight: bold">
            Get Recommendation Based on
          </h5>
        </br>
          
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            style="
              font-size: 28px;
              border: none;
              background-color: transparent;
              font-weight: bold;
            "
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <form onsubmit="return false;">
            <input type="hidden" id="user-id" value="{{ current_user.id }}">
            <div id="preference-form">
              <div class="slider">
                <div class="slider-text">
                <span>Totally different artists</span>
                <span id="artistValue">0</span>
                <span>Artists I liked before</span>
                </div>
                
                <input
                  type="range"
                  min="-50"
                  max="50"
                  step="1"
                  class="slider-input"
                  id="artistSlider"
                />

              </div>



              <div class="slider">
                <div class="slider-text">
                <span>Totally different genres</span>
                <span id="genreValue"></span>
                <span>Genres I liked before</span>

                </div>
                
                <input
                  type="range"
                  min="-50"
                  max="50"
                  step="1"
                  class="slider-input"
                  id="genreSlider"
                />

              </div>



              <div class="slider" style="margin-bottom: 40px;">
                <div class="slider-text">
                <span>Totally different styles</span>
                <span id="styleValue"></span>
                <span>Styles I liked before</span>

                </div>
                
                <input
                  type="range"
                  min="-50"
                  max="50"
                  step="1"
                  class="slider-input"
                  id="styleSlider"
                />

              </div>

            </div>

              <button
                type="submit"
                onclick="submitRecommendationForm()"
                id="save-btn"
                class="btn btn-primary btn-dark"
                style="margin-top: 10px; margin-bottom: 10px; width: 100%"
              >
                Save
              </button>

            </div>
          </form>
        </div>
      </div>
    </div>
  </div>



 <!-- model-->
 <div
 class="modal fade"
 style="display: none;"
 id="preference"
 tabindex="-1"
 role="dialog"
 aria-hidden="true"
>
 <div class="modal-dialog modal-dialog-centered" role="document">
   <div class="modal-content">
     <!-- 模态框头部 -->
     <div class="modal-header">
       <h5 class="modal-title" style="font-weight: bold">
         My preference
       </h5>
     </br>
       
       <button
         type="button"
         class="close"
         data-dismiss="modal"
         style="
           font-size: 28px;
           border: none;
           background-color: transparent;
           font-weight: bold;
         "
         aria-label="Close"
       >
         <span aria-hidden="true">&times;</span>
       </button>
     </div>

     <!-- <div class="modal-body">
      <div>
      <table>
        {% for category, preferences in user_prefs.items() %}
        <tr>
            <td>{{ category }}</td>
            <td>
                <ul>
                    {% for preference, count in preferences.items() %}
                    <li>{{ preference }}: {{ count }}</li>
                    {% endfor %}
                </ul>
            </td>
        </tr>
        {% endfor %}    
    </table>
  </div>
  <div style="margin-top: 20px;">

    <a id="toggle-weight" style="cursor: pointer;text-decoration: underline;" > Set up weight</a> 
  </div>
 </div> -->

 <div class="modal-body">
  <div class="category-container">
    <h3 class="category-title">Artists</h3>
    <ul class="tag-list">
      {% for artist in user_prefs.artist %}
      <li class="tag-preference tag-artist">{{ artist }}</li>
      {% endfor %}
    </ul>
  </div>
  <div class="category-container">
    <h3 class="category-title">Genres</h3>
    <ul class="tag-list">
      {% for genre in user_prefs.genre %}
      <li class="tag-preference tag-genre">{{ genre}}</li>
      {% endfor %}
    </ul>
  </div>
  <div class="category-container">
    <h3 class="category-title">Styles</h3>
    <ul class="tag-list">
      {% for style in user_prefs.style %}
      <li class="tag-preference tag-style">{{ style }}</li>
      {% endfor %}
    </ul>
  </div>
</div>

</div>
 </div>
</div>

<script>
// Get user preferences from the backend
const userPrefs = JSON.parse('{{ user_prefs | tojson | safe }}');
console.log(userPrefs)

// Get recommended artwork details from the backend
const recommended_json = JSON.parse('{{ recommended_json | tojson | safe }}');
console.log(recommended_json)

const url = new URL(window.location.href);

const searchParams = new URLSearchParams(url.search);

const weightArtist = searchParams.get('weight_artist');
const weightGenre = searchParams.get('weight_genre');
const weightStyle = searchParams.get('weight_style');



recommended_json.forEach(artwork => {
  let artistTag = [...artwork.artistName.split(',')];
  let genreTag =  [...artwork.genres.split(', ')];
  let styleTag =[...artwork.styles.split(', ')];
 

  const tagsContainer = document.getElementById('tags-' + artwork.id);

  for (let i = 0; i < artistTag.length; i++) {
    const tag = document.createElement('span');
    if ((weightArtist > 0 && Object.keys(userPrefs.artist).includes(artistTag[i])) || (weightArtist < 0 && !Object.keys(userPrefs.artist).includes(artistTag[i]))){
      tag.className ='tag tag1-artist';
      tag.innerHTML =  `<?xml version="1.0" encoding="UTF-8"?><svg width="14" height="14" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="12" r="8" fill="none" stroke="#ffe0e6" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M42 44C42 34.0589 33.9411 26 24 26C14.0589 26 6 34.0589 6 44" stroke="#ffe0e6" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>`
    tag.innerHTML += `  ${artistTag[i]}`
    }
    else{
    tag.className = 'tag';
    tag.innerHTML =  `<?xml version="1.0" encoding="UTF-8"?><svg width="14" height="14" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="24" cy="12" r="8" fill="none" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M42 44C42 34.0589 33.9411 26 24 26C14.0589 26 6 34.0589 6 44" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>`
    tag.innerHTML += `  ${artistTag[i]}`;}

    tagsContainer.appendChild(tag);
  }


for (let i = 0; i < genreTag.length; i++) {
    const tag = document.createElement('span');
    if ((weightGenre > 0 && Object.keys(userPrefs.genre).includes(genreTag[i])) || (weightGenre < 0 && !Object.keys(userPrefs.genre).includes(genreTag[i]))){
      tag.className ='tag tag1-genre';
      tag.innerHTML =  `<?xml version="1.0" encoding="UTF-8"?><svg width="14" height="14" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24 44C29.9601 44 26.3359 35.136 30 31C33.1264 27.4709 44 29.0856 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#fff5cc" stroke-width="4" stroke-linejoin="round"/><path d="M28 17C29.6569 17 31 15.6569 31 14C31 12.3431 29.6569 11 28 11C26.3431 11 25 12.3431 25 14C25 15.6569 26.3431 17 28 17Z" fill="none" stroke="#fff5cc" stroke-width="4" stroke-linejoin="round"/><path d="M16 21C17.6569 21 19 19.6569 19 18C19 16.3431 17.6569 15 16 15C14.3431 15 13 16.3431 13 18C13 19.6569 14.3431 21 16 21Z" fill="none" stroke="#fff5cc" stroke-width="4" stroke-linejoin="round"/><path d="M17 34C18.6569 34 20 32.6569 20 31C20 29.3431 18.6569 28 17 28C15.3431 28 14 29.3431 14 31C14 32.6569 15.3431 34 17 34Z" fill="none" stroke="#fff5cc" stroke-width="4" stroke-linejoin="round"/></svg>`
    tag.innerHTML += `  ${genreTag[i]}`
    }
    else{
    tag.className = 'tag';
    tag.innerHTML =  `<?xml version="1.0" encoding="UTF-8"?><svg width="14" height="14" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24 44C29.9601 44 26.3359 35.136 30 31C33.1264 27.4709 44 29.0856 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#ffffff" stroke-width="4" stroke-linejoin="round"/><path d="M28 17C29.6569 17 31 15.6569 31 14C31 12.3431 29.6569 11 28 11C26.3431 11 25 12.3431 25 14C25 15.6569 26.3431 17 28 17Z" fill="none" stroke="#ffffff" stroke-width="4" stroke-linejoin="round"/><path d="M16 21C17.6569 21 19 19.6569 19 18C19 16.3431 17.6569 15 16 15C14.3431 15 13 16.3431 13 18C13 19.6569 14.3431 21 16 21Z" fill="none" stroke="#ffffff" stroke-width="4" stroke-linejoin="round"/><path d="M17 34C18.6569 34 20 32.6569 20 31C20 29.3431 18.6569 28 17 28C15.3431 28 14 29.3431 14 31C14 32.6569 15.3431 34 17 34Z" fill="none" stroke="#ffffff" stroke-width="4" stroke-linejoin="round"/></svg>`
    tag.innerHTML += `  ${genreTag[i]}`;}

    tagsContainer.appendChild(tag);
  }



  for (let i = 0; i < styleTag.length; i++) {
    const tag = document.createElement('span');
    if ((weightStyle > 0 && Object.keys(userPrefs.style).includes(styleTag[i])) || (weightStyle < 0 && !Object.keys(userPrefs.style).includes(styleTag[i]))){
      tag.className ='tag tag1-style';
      tag.innerHTML =  `<?xml version="1.0" encoding="UTF-8"?><svg width="14" height="14" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 44V14L14 4H44V34L34 44H4Z" stroke="#e1f5fe" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M34 14V44" stroke="#e1f5fe" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 4L14 34" stroke="#e1f5fe" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 14L34 14" stroke="#e1f5fe" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M44 4L34 14" stroke="#e1f5fe" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 44L14 34" stroke="#e1f5fe" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 34L44 34" stroke="#e1f5fe" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>`
    tag.innerHTML += `  ${styleTag[i]}`
    }
    else{
    tag.className = 'tag';
    tag.innerHTML =  `<?xml version="1.0" encoding="UTF-8"?><svg width="14" height="14" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 44V14L14 4H44V34L34 44H4Z" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M34 14V44" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 4L14 34" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 14L34 14" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M44 4L34 14" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 44L14 34" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 34L44 34" stroke="#ffffff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>`
    tag.innerHTML += `  ${styleTag[i]}`;}

    tagsContainer.appendChild(tag);
  }


});




</script>

<script>
// 监听toggle-weight点击事件
$("#toggle-weight").click(function(){
  $('#preference').modal('hide'); // 隐藏preference模态框
  $('#weightModal').modal('show'); // 显示weight模态框
});

// 监听toggle-preference点击事件
$("#toggle-preference").click(function(){
  $('#weightModal').modal('hide'); // 隐藏weight模态框
  $('.modal-backdrop').remove();
  $('#preference').modal('show'); // 显示preference模态框
});
</script>



  <script>
    function setupSlider(slider, value) {
      value.innerHTML = slider.value + "%";
      slider.oninput = function() {
        value.innerHTML = this.value + "%";
      };
    }
    
    const artist_slider = document.getElementById('artistSlider');
    const artist_value = document.getElementById('artistValue');
    // const artist_progress = document.getElementById('artistProgress');
    setupSlider(artist_slider, artist_value);
    
    const genre_slider = document.getElementById('genreSlider');
    const genre_value = document.getElementById('genreValue');
    // const genre_progress = document.getElementById('genreProgress');
    setupSlider(genre_slider, genre_value);
    
    const style_slider = document.getElementById('styleSlider');
    const style_value = document.getElementById('styleValue');
    // const style_progress = document.getElementById('styleProgress');
    setupSlider(style_slider, style_value);



    function submitRecommendationForm() {
  const weightArtist = artist_slider.value;
  const weightGenre = genre_slider.value;
  const weightStyle = style_slider.value;

  localStorage.setItem('weight_artist', weightArtist);
  localStorage.setItem('weight_genre', weightGenre);
  localStorage.setItem('weight_style', weightStyle);



 const userId = document.getElementById('user-id').value;
  const url = `/recommendations?user_id=${userId}&weight_artist=${weightArtist}&weight_genre=${weightGenre}&weight_style=${weightStyle}`;
  window.location.href = url;

}
    </script>


<script>
  $(document).ready(function() {
  // Get values from localStorage
  const artistValue = localStorage.getItem('weight_artist') || 50;
  const genreValue = localStorage.getItem('weight_genre') || 50;
  const styleValue = localStorage.getItem('weight_style') || 50;

  // Set slider values
  $('#artistSlider').val(artistValue);
  $('#genreSlider').val(genreValue);
  $('#styleSlider').val(styleValue);

  // Set slider value display
  $('#artistValue').text(artistValue + '%');
  $('#genreValue').text(genreValue + '%');
  $('#styleValue').text(styleValue + '%');
});



</script>





  </body>
</html>
